# 事务序
目前事务序功能尚未完全适配，仅可使用一些特定用例。
如需测试，需进行以下修改：
## traffic.csv
```
taskId,sourceNodeId,destNodeId,dataSize(Byte),opType,priority,delay,phaseId,dependOnPhases
0,0,7,655360,URMA_WRITE,7,10ns,1,
1,0,7,655360,URMA_WRITE,7,10ns,1,
2,0,7,655360,URMA_WRITE,7,10ns,1,
3,0,7,655360,URMA_WRITE,7,10ns,1,
4,0,7,655360,URMA_WRITE,7,10ns,1,
5,0,7,655360,URMA_WRITE,7,10ns,1,
6,0,7,655360,URMA_WRITE,7,10ns,1,
7,0,7,655360,URMA_WRITE,7,10ns,1,
```
流的源目的节点相同，且勿要有依赖关系，否则会导致未知问题。
## ub-api-urma.cc
```
// 本用例所有原目的节点相同的wqe都绑在同一个jetty上
void UbApiUrma::SendTrafficForTest(TrafficRecord record)
{
    if (record.priority == 0) {
        NS_LOG_DEBUG("Task uses the highest priority, not recommended.");
    }
    std::vector<OrderType> type = {
        OrderType::ORDER_RELAX,
        OrderType::ORDER_STRONG,
        OrderType::ORDER_RELAX,
        OrderType::ORDER_STRONG,
        OrderType::ORDER_RELAX,
        OrderType::ORDER_STRONG,
        OrderType::ORDER_RELAX,
        OrderType::ORDER_STRONG};
        ...
}
```
修改vector中的值，填写各流的事务序类型，数目需和流数一致

```
void UbApiUrma::ScheduleNextTasks()
{
    for (auto it = m_readyTasks.begin(); it != m_readyTasks.end();) {
        uint32_t taskId = *it;
        // 确认任务仍然是就绪状态
        if (m_taskStates[taskId] == TaskState::READY) {
            m_taskStates[taskId] = TaskState::RUNNING;
            auto taskIt = m_tasks.find(taskId);
            if (taskIt != m_tasks.end()) {
                // SendTraffic(taskIt->second);
                SendTrafficForTest(taskIt->second);
                NS_LOG_DEBUG("Scheduled task " << taskId);
            }
        }

        it = m_readyTasks.erase(it);
    }
}
```
使用SendTrafficForTest